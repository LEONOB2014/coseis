#!/usr/bin/env python
"""
TPV3 - SCEC validation problem version 3, convergence test
"""
import sord

debug = 0
_run = [ 
    500.0, (1, 1, 2),
    300.0, (1, 1, 2),
    250.0, (1, 1, 2),
    150.0, (1, 1, 2),
    100.0, (1, 1, 2),
]
_run = [ 
    500.0, (1, 4, 4),
    300.0, (1, 4, 4),
    250.0, (1, 4, 4),
    150.0, (1, 4, 4),
    100.0, (1, 4, 4),
    75.0,  (1, 4, 4),
    50.0,  (1, 4, 8),
    30.0,  (1, 8, 8),
    25.0,  (1, 8, 16),
    15.0,  (1, 16, 16),
    10.0,  (4, 16, 16),
]
_run = [ 50.0, (1, 1, 2), ]
_run = [ 150.0, (1, 1, 2), ]
vrup = -1.
faultnormal = 3	
hourglass = 1.0, 2.0

for i in range( 0, len( _run ), 2 ):
    np3 = _run[i+1]
    dx = 3 * [ _run[i] ]
    dt = dx[0] / 12500.0
    nt = int( 12.0 / dt + 1.5 )
    nn = ( 
        int( 16500.0 / dx[0] + 21.5 ),
        int(  9000.0 / dx[1] + 21.5 ),
        int(  6000.0 / dx[2] + 20.5 ),
    )
    bc1     = 10, 10, 10
    bc2     = -1,  1, -2
    ihypo   = -1, -1, -1.5
    fixhypo = -1

    j, k, l = -1, -1, -2
    _jj = -int( 15000.0 / dx[0] + 1.5 ), -1
    _kk = -int(  7500.0 / dx[1] + 1.5 ), -1
    _ll = -int(  3000.0 / dx[2] + 1.5 ), -1
    _oo = -int(  1500.0 / dx[0] + 1.5 ), -1
    _xx = -int(  1500.0 / dx[0] + 0.5 ), -1

    fieldio = [
        ( '=',  'rho',  [],               2670.0    ),
        ( '=',  'vp',   [],               6000.0    ),
        ( '=',  'vs',   [],               3464.0    ),
        ( '=',  'gam',  [],               0.2       ),
        ( '=',  'dc',   [],               0.4       ),
        ( '=',  'mud',  [],               0.525     ),
        ( '=',  'mus',  [],               1e4       ),
        ( '=',  'tn',   [],              -120e6     ),
        ( '=',  'ts',   [],                70e6     ),
       #( '=c', 'gam',  [], 0.02  (-15001., -7501., -4500.), (15001., 7501., 4500.) ),
       #( '=c', 'mus',  [], 0.677 (-15001., -7501.,    -1.), (15001., 7501.,    1.) ),
       #( '=c', 'ts',   [], 72.9e6 (-1501., -1501.,    -1.), (1501.,  1501.,    1.) ),
       #( '=c', 'ts',   [], 75.8e6 (-1501., -1499.,    -1.), (1501.,  1499.,    1.) ),
       #( '=c', 'ts',   [], 75.8e6 (-1499., -1501.,    -1.), (1499.,  1501.,    1.) ),
       #( '=c', 'ts',   [], 81.6e6 (-1499., -1499.,    -1.), (1499.,  1499.,    1.) ),
        ( '=',  'gam',  [_jj,_kk,_ll,()],  0.02      ),
        ( '=',  'mus',  [_jj,_kk, l, ()],  0.677     ),
        ( '=',  'ts',   [_oo,_oo, l, ()],  72.9e6    ),
        ( '=',  'ts',   [_xx,_oo, l, ()],  75.8e6    ),
        ( '=',  'ts',   [_oo,_xx, l, ()],  75.8e6    ),
        ( '=',  'ts',   [_xx,_xx, l, ()],  81.6e6    ),
        ( '=w', 'x1',   [_jj,_kk, l, ()], 'flt-x1'   ),
        ( '=w', 'x2',   [_jj,_kk, l, ()], 'flt-x2'   ),
        ( '=w', 'tsm',  [_jj,_kk, l, -1], 'flt-tsm'  ),
        ( '=w', 'su1',  [_jj,_kk, l, -1], 'flt-su1'  ),
        ( '=w', 'su2',  [_jj,_kk, l, -1], 'flt-su2'  ),
        ( '=w', 'psv',  [_jj,_kk, l, -1], 'flt-psv'  ),
        ( '=w', 'trup', [_jj,_kk, l, -1], 'flt-trup' ),
       #( '=w', 'tsm',  [_jj,_kk, l,  1], 'flt-tsm0' ),
       #( '=w', 'tnm',  [_jj, k,  l, ()], 'xt-tnm'   ),
       #( '=w', 'tsm',  [_jj, k,  l, ()], 'xt-tsm'   ),
       #( '=w', 'sam',  [_jj, k,  l, ()], 'xt-sam'   ),
       #( '=w', 'svm',  [_jj, k,  l, ()], 'xt-svm'   ),
       #( '=w', 'sl',   [_jj, k,  l, ()], 'xt-sl'    ),
       #( '=w', 'vm2',  [0,k,0,(1,-1,10)], 'xh' ),
       #( '=w', 'vm2',  [j,0,0,(1,-1,10)], 'xv' ),
    ]

    for f in 'su1', 'su2', 'sv1', 'sv2', 'ts1', 'ts2':
        fieldio += [
            ( '=wx', f, [], 'P1a-'+f, (-7499.,  -1., 0.) ),
            ( '=wx', f, [], 'P1b-'+f, (-7451., -49., 0.) ),
            ( '=wx', f, [], 'P2a-'+f, ( -1., -5999., 0.) ),
            ( '=wx', f, [], 'P2b-'+f, (-49., -5951., 0.) ),
        ]

    rundir = '~/run/tpv3-%03.0f' % dx[0]
    sord.run( locals() )

