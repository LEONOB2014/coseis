function [ f ] = mirror( f, bc1, bc2, x )

j = size( f, 1 );
k = size( f, 2 );
l = size( f, 3 );
nc = size( f, 5 );
n = [ j k l ];
i1 = abs( bc1 );
i2 = abs( bc2 );
i1(n==1) = 0;
i1(n==1) = 0;
off1 = [ 0 0 0 ];
off2 = [ 0 0 0 ];
if x
  bc1 = i1;
  bc2 = i2;
  off1 = squeeze( f(1,1,1,:) );
  off2 = squeeze( f(j,k,l,:) );
end

switch nc;
case 1

if ( i1(1) == 3 ); f(j:2*j-1,:,:,:) = f; f(j-1:-1:1,:,:,:) = f(j+1:2*j-1,:,:,:); end
if ( i1(2) == 3 ); f(:,k:2*k-1,:,:) = f; f(:,k-1:-1:1,:,:) = f(:,k+1:2*k-1,:,:); end
if ( i1(3) == 3 ); f(:,:,l:2*l-1,:) = f; f(:,:,l-1:-1:1,:) = f(:,:,l+1:2*l-1,:); end

if ( i2(1) == 3 ); i = size(f,1); f(i+j-1:-1:i+1,:,:,:) = f(i-j+1:i-1,:,:,:); end
if ( i2(2) == 3 ); i = size(f,2); f(:,i+k-1:-1:i+1,:,:) = f(:,i-k+1:i-1,:,:); end
if ( i2(3) == 3 ); i = size(f,3); f(:,:,i+l-1:-1:i+1,:) = f(:,:,i-l+1:i-1,:); end

case 3

if ( i1(1) == 3 )
  s = sign( bc1(1) );
  f(j:2*j-1,:,:,:,:) = f;
  f(j-1:-1:1,:,:,:,1) = off1(1) - s * f(j+1:2*j-1,:,:,:,1);
  f(j-1:-1:1,:,:,:,2) = s * f(j+1:2*j-1,:,:,:,2);
  f(j-1:-1:1,:,:,:,3) = s * f(j+1:2*j-1,:,:,:,3);
end
if ( i1(2) == 3 )
  s = sign( bc1(2) );
  f(:,k:2*k-1,:,:,:) = f;
  f(:,k-1:-1:1,:,:,1) = s * f(:,k+1:2*k-1,:,:,1);
  f(:,k-1:-1:1,:,:,2) = off1(2) - s * f(:,k+1:2*k-1,:,:,2);
  f(:,k-1:-1:1,:,:,3) = s * f(:,k+1:2*k-1,:,:,3);
end
if ( i1(3) == 3 )
  s = sign( bc1(3) );
  f(:,:,l:2*l-1,:,:) = f;
  f(:,:,l-1:-1:1,:,1) = s * f(:,:,l+1:2*l-1,:,1);
  f(:,:,l-1:-1:1,:,2) = s * f(:,:,l+1:2*l-1,:,2);
  f(:,:,l-1:-1:1,:,3) = off1(3) - s * f(:,:,l+1:2*l-1,:,3);
end

if ( i2(1) == 3 )
  s = sign( bc2(1) );
  i = size( f, 1 );
  f(i+j-1:-1:i+1,:,:,:,1) = off2(1) - s * f(i-j+1:i-1,:,:,:,1);
  f(i+j-1:-1:i+1,:,:,:,2) = s * f(i-j+1:i-1,:,:,:,2);
  f(i+j-1:-1:i+1,:,:,:,3) = s * f(i-j+1:i-1,:,:,:,3);
end
if ( i2(2) == 3 )
  s = sign( bc2(2) );
  i = size( f, 2 );
  f(:,i+k-1:-1:i+1,:,:,1) = s * f(:,i-k+1:i-1,:,:,1);
  f(:,i+k-1:-1:i+1,:,:,2) = off2(2) - s * f(:,i-k+1:i-1,:,:,2);
  f(:,i+k-1:-1:i+1,:,:,3) = s * f(:,i-k+1:i-1,:,:,3);
end
if ( i2(3) == 3 )
  s = sign( bc2(3) );
  i = size( f, 3 );
  f(:,:,i+l-1:-1:i+1,:,1) = s * f(:,:,i-l+1:i-1,:,1);
  f(:,:,i+l-1:-1:i+1,:,2) = s * f(:,:,i-l+1:i-1,:,2);
  f(:,:,i+l-1:-1:i+1,:,3) = off2(3) - s * f(:,:,i-l+1:i-1,:,3);
end

end

