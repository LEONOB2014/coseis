function [ f ] = mirror( f, bc1, bc2, x )

j = size( f, 1 );
k = size( f, 2 );
l = size( f, 3 );
nc = size( f, 5 );
n = [ j k l ];
bc1(n==1) = 0;
bc2(n==1) = 0;
b1 = abs( bc1 );
b2 = abs( bc2 );
s1 = sign( bc1 );
s2 = sign( bc2 );
if x
  s1 = [ 1 1 1 ];
  s2 = [ 1 1 1 ];
end
if b1(1) == 2, f(1,:,:,:,:) = []; end
if b1(2) == 2, f(:,1,:,:,:) = []; end
if b1(3) == 2, f(:,:,1,:,:) = []; end
if b2(1) == 2, f(end,:,:,:,:) = []; end
if b2(2) == 2, f(:,end,:,:,:) = []; end
if b2(3) == 2, f(:,:,end,:,:) = []; end
j = size( f, 1 );
k = size( f, 2 );
l = size( f, 3 );

switch nc;
case 1

% Mirror on the cell
if ( b1(1) == 2 ); f(j+1:2*j,:,:,:) = f; f(j:-1:1,:,:,:) = f(j+1:2*j,:,:,:); end
if ( b1(2) == 2 ); f(:,k+1:2*k,:,:) = f; f(:,k:-1:1,:,:) = f(:,k+1:2*k,:,:); end
if ( b1(3) == 2 ); f(:,:,l+1:2*l,:) = f; f(:,:,l:-1:1,:) = f(:,:,l+1:2*l,:); end
if ( b2(1) == 2 ); i = size(f,1); f(i+j:-1:i+1,:,:,:) = f(i-j+1:i,:,:,:); end
if ( b2(2) == 2 ); i = size(f,2); f(:,i+k:-1:i+1,:,:) = f(:,i-k+1:i,:,:); end
if ( b2(3) == 2 ); i = size(f,3); f(:,:,i+l:-1:i+1,:) = f(:,:,i-l+1:i,:); end

% Mirror on the node
if ( b1(1) == 1 ); f(j:2*j-1,:,:,:) = f; f(j-1:-1:1,:,:,:) = f(j+1:2*j-1,:,:,:); end
if ( b1(2) == 1 ); f(:,k:2*k-1,:,:) = f; f(:,k-1:-1:1,:,:) = f(:,k+1:2*k-1,:,:); end
if ( b1(3) == 1 ); f(:,:,l:2*l-1,:) = f; f(:,:,l-1:-1:1,:) = f(:,:,l+1:2*l-1,:); end
if ( b2(1) == 1 ); i = size(f,1); f(i+j-1:-1:i+1,:,:,:) = f(i-j+1:i-1,:,:,:); end
if ( b2(2) == 1 ); i = size(f,2); f(:,i+k-1:-1:i+1,:,:) = f(:,i-k+1:i-1,:,:); end
if ( b2(3) == 1 ); i = size(f,3); f(:,:,i+l-1:-1:i+1,:) = f(:,:,i-l+1:i-1,:); end

case 3

% Mirror on the cell
if ( b1(1) == 2 )
  o = x * ( 3 * f(1,1,1,1) - f(2,1,1,1) );
  f(j+1:2*j,:,:,:,:) = f;
  f(j:-1:1,:,:,:,1) = o - s1(1) * f(j+1:2*j,:,:,:,1);
  f(j:-1:1,:,:,:,2) =     s1(1) * f(j+1:2*j,:,:,:,2);
  f(j:-1:1,:,:,:,3) =     s1(1) * f(j+1:2*j,:,:,:,3);
end
if ( b1(2) == 2 )
  o = x * ( 3 * f(1,1,1,1) - f(1,2,1,2) );
  f(:,k+1:2*k,:,:,:) = f;
  f(:,k:-1:1,:,:,1) =     s1(2) * f(:,k+1:2*k,:,:,1);
  f(:,k:-1:1,:,:,2) = o - s1(2) * f(:,k+1:2*k,:,:,2);
  f(:,k:-1:1,:,:,3) =     s1(2) * f(:,k+1:2*k,:,:,3);
end
if ( b1(3) == 2 )
  o = x * ( 3 * f(1,1,1,1) - f(1,1,2,3) );
  f(:,:,l+1:2*l,:,:) = f;
  f(:,:,l:-1:1,:,1) =     s1(3) * f(:,:,l+1:2*l,:,1);
  f(:,:,l:-1:1,:,2) =     s1(3) * f(:,:,l+1:2*l,:,2);
  f(:,:,l:-1:1,:,3) = o - s1(3) * f(:,:,l+1:2*l,:,3);
end
if ( b2(1) == 2 )
  o = x * ( 3 * f(j,k,l,1) - f(j-1,k,l,1) );
  i = size( f, 1 );
  f(i+j:-1:i+1,:,:,:,1) = o - s2(1) * f(i-j+1:i,:,:,:,1);
  f(i+j:-1:i+1,:,:,:,2) =     s2(1) * f(i-j+1:i,:,:,:,2);
  f(i+j:-1:i+1,:,:,:,3) =     s2(1) * f(i-j+1:i,:,:,:,3);
end
if ( b2(2) == 2 )
  o = x * ( 3 * f(j,k,l,2) - f(j,k-1,l,2) );
  i = size( f, 2 );
  f(:,i+k:-1:i+1,:,:,1) =     s2(2) * f(:,i-k+1:i,:,:,1);
  f(:,i+k:-1:i+1,:,:,2) = o - s2(2) * f(:,i-k+1:i,:,:,2);
  f(:,i+k:-1:i+1,:,:,3) =     s2(2) * f(:,i-k+1:i,:,:,3);
end
if ( b2(3) == 2 )
  o = x * ( 3 * f(j,k,l,3) - f(j,k,l-1,3) );
  i = size( f, 3 );
  f(:,:,i+l:-1:i+1,:,1) =     s2(3) * f(:,:,i-l+1:i,:,1);
  f(:,:,i+l:-1:i+1,:,2) =     s2(3) * f(:,:,i-l+1:i,:,2);
  f(:,:,i+l:-1:i+1,:,3) = o - s2(3) * f(:,:,i-l+1:i,:,3);
end

% Mirror on the node
if ( b1(1) == 1 )
  o = x * 2 * f(1,1,1,1);
  f(j:2*j-1,:,:,:,:) = f;
  f(j-1:-1:1,:,:,:,1) = o - s1(1) * f(j+1:2*j-1,:,:,:,1);
  f(j-1:-1:1,:,:,:,2) =     s1(1) * f(j+1:2*j-1,:,:,:,2);
  f(j-1:-1:1,:,:,:,3) =     s1(1) * f(j+1:2*j-1,:,:,:,3);
end
if ( b1(2) == 1 )
  o = x * 2 * f(1,1,1,2);
  f(:,k:2*k-1,:,:,:) = f;
  f(:,k-1:-1:1,:,:,1) =     s1(2) * f(:,k+1:2*k-1,:,:,1);
  f(:,k-1:-1:1,:,:,2) = o - s1(2) * f(:,k+1:2*k-1,:,:,2);
  f(:,k-1:-1:1,:,:,3) =     s1(2) * f(:,k+1:2*k-1,:,:,3);
end
if ( b1(3) == 1 )
  o = x * 2 * f(1,1,1,3);
  f(:,:,l:2*l-1,:,:) = f;
  f(:,:,l-1:-1:1,:,1) =     s1(3) * f(:,:,l+1:2*l-1,:,1);
  f(:,:,l-1:-1:1,:,2) =     s1(3) * f(:,:,l+1:2*l-1,:,2);
  f(:,:,l-1:-1:1,:,3) = o - s1(3) * f(:,:,l+1:2*l-1,:,3);
end
if ( b2(1) == 1 )
  o = x * 2 * f(j,k,l,1);
  i = size( f, 1 );
  f(i+j-1:-1:i+1,:,:,:,1) = o - s2(1) * f(i-j+1:i-1,:,:,:,1);
  f(i+j-1:-1:i+1,:,:,:,2) =     s2(1) * f(i-j+1:i-1,:,:,:,2);
  f(i+j-1:-1:i+1,:,:,:,3) =     s2(1) * f(i-j+1:i-1,:,:,:,3);
end
if ( b2(2) == 1 )
  o = x * 2 * f(j,k,l,2);
  i = size( f, 2 );
  f(:,i+k-1:-1:i+1,:,:,1) =     s2(2) * f(:,i-k+1:i-1,:,:,1);
  f(:,i+k-1:-1:i+1,:,:,2) = o - s2(2) * f(:,i-k+1:i-1,:,:,2);
  f(:,i+k-1:-1:i+1,:,:,3) =     s2(2) * f(:,i-k+1:i-1,:,:,3);
end
if ( b2(3) == 1 )
  o = x * 2 * f(j,k,l,3);
  i = size( f, 3 );
  f(:,:,i+l-1:-1:i+1,:,1) =     s2(3) * f(:,:,i-l+1:i-1,:,1);
  f(:,:,i+l-1:-1:i+1,:,2) =     s2(3) * f(:,:,i-l+1:i-1,:,2);
  f(:,:,i+l-1:-1:i+1,:,3) = o - s2(3) * f(:,:,i-l+1:i-1,:,3);
end

end

