# Wat2Q IBM Blue Gene/Q
maxnodes: 1024
maxcores: 16
maxram: 16384

# MPI
ppn_range: [1, 2, 4, 8, 16, 32]
nthread: 1
launch:
    runjob
    --exe {command}
    -n {nproc}
    -p {ppn}
    --verbose=INFO
    --block $COBALT_PARTNAME
    ${{COBALT_SHAPE:+--shape}} $COBALT_SHAPE
    ${{COBALT_CORNER:+--corner}} $COBALT_CORNER
    --envs
        BG_SHAREDMEMSIZE=32MB
        PAMID_VERBOSE=1
        VPROF_PROFILE=yes\n

# MPI + OpenMP
ppn_range: [1]
nthread: 32
launch:
    runjob
    --exe {command}
    -n {nproc}
    -p {ppn}
    --verbose=INFO
    --block $COBALT_PARTNAME
    ${{COBALT_SHAPE:+--shape}} $COBALT_SHAPE
    ${{COBALT_CORNER:+--corner}} $COBALT_CORNER
    --envs
        BG_SHAREDMEMSIZE=32MB
        PAMID_VERBOSE=1
        VPROF_PROFILE=yes
        OMP_NUM_THREADS={nthread}\n

# job submission
notify: -M {email}
submit:
    qsub
    {notify}
    -O {name}
    -A {account}
    -n {nodes}
    -t {minutes}
    --mode script
    --env BG_SHAREDMEMSIZE=32MB:PAMID_VERBOSE=1:VPROF_PROFILE=yes
    {submit_flags}
    "{name}.sh"
submit2:
    qsub {notify}
    -O {name}
    -A {account}
    -n {nodes}
    -t {minutes}
    --mode script
    --env BG_SHAREDMEMSIZE=32MB:PAMID_VERBOSE=1:VPROF_PROFILE=yes
    --dependenices {depend}
    {submit_flags}
    "{name}.sh"
