# Makefile
MACHINE = {machine}
OMP = 1
CC =
FC =

all: hello.c.x hello.f.x

hello.c.x : hello.c Makefile
	$(CC) $(CFLAGS) -o $@ $< $(LIBS)

hello.f.x : hello.f90 Makefile
	$(FC) $(FFLAGS) -o $@ $< $(LIBS)

clean:
	rm -rf *.pyc run hello.?.x hello.?.x.dSYM

distclean : clean
	rm Makefile

# ALCF IBM Blue Gene/P
ifeq ($(MACHINE), ALCF-BGP)
    CC = mpixlc_r
    FC = mpixlf2003_r
    CFLAGS = $(LDFLAGS) -qlist -qreport
    FFLAGS = $(LDFLAGS) -qlist -qreport
    LDFLAGS = -g -O3 -qsuppress=cmpmsg
    LIBS = /home/morozov/lib/libmpihpm.a
    ifdef OMP
        LDFLAGS += -qsmp=omp
    endif
endif

# ALCF IBM Blue Gene/Q
ifeq ($(MACHINE), ALCF-BGQ)
    CC = mpixlc_r
    FC = mpixlf2003_r
    CLFAGS = $(LDFLAGS) -qlist -qreport
    FFLAGS = $(LDFLAGS) -qlist -qreport
    LDFLAGS = -g -O3 -qsuppress=cmpmsg
    LIBS = -lSPI_upci_cnk
    ifdef OMP
        LDFLAGS += -qsmp=omp:noauto
        LIBS += /home/morozov/HPM/lib/libmpihpm_smp.a
    else
        LIBS += /home/morozov/HPM/lib/libmpihpm.a
    endif
    LIBS += /bgsys/drivers/ppcfloor/bgpm/lib/libbgpm.a
endif

# Default: GNU Compiler Collection
ifndef CC
    CC = mpicc
    FC = mpif90 
    CFLAGS = $(LDFLAGS) -pedantic
    FFLAGS = $(LDFLAGS) -fimplicit-none
    LDFLAGS = -g -O3 -Wall
    ifdef OMP
        LDFLAGS += -fopenmp
    endif
endif

