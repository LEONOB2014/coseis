#!/bin/bash -e
# Default run scripts

cat << END > run
#!/bin/bash -e
mode=$mode
cd "$rundir"
[ "\$mode" = p ] && mpich2version &> /dev/null && ! mpdtrace &> /dev/null && mpd --daemon
echo "\$(date): $code started" >> log
$pre
case "\$mode\${1:--i}" in
  s-i)   time $bin ;;
  s-g)   gdb $bin ;;
  s-ddd) ddd $bin ;;
  p-i)   mpiexec -np $np time $bin ;;
  p-g)   mpiexec -gdb -np $np $bin ;;
  p-ddd) mpiexec -np $np ddd $bin ;;
esac
$post
echo "\$(date): $code finished" >> log
END

cat << END > que
#!/bin/bash -e
cd "$rundir"
[ "\$mode" = p ] && mpich2version &> /dev/null && ! mpdtrace &> /dev/null && mpd --daemon
nice nohup ./run > out.log &
pid=\$!
echo "\$(date): PID: \$pid" >> log
echo "$code started with PID: \$pid"
END

chmod u+x run que

