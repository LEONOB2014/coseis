#!/bin/bash -e

dir=$( /bin/pwd )
base=$( basename "$dir" )
version=$( date +%Y%m%d%H%M%S )

s=""
while getopts s opt; do eval "$opt=y"; done

cat << END > versionmeta.py
version = '$version'
login   = '$LOGNAME'
name    = '$( finger $LOGNAME | sed -n 's/^Login.*:.*e: //p' )'
host    = '$HOSTNAME'
dir     = '$dir'
END

files="
    $base/versionmeta.py
    $base/doc
    $base/make.sh
    $base/sord
    $base/sord.py
    $base/in
    $base/sh
    $base/src
"
mkdir -p tmp
cd $( dirname "$dir" )
tar cfh - $files | gzip > "$dir/tmp/$base.tgz"
cd "$dir"

mkdir -p save
[ "$s" ] && cp "tmp/$base.tgz" "save/$base-$version.tgz"

exit 0

